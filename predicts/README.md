# CalSnap API - –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–∏—â–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º AI

–°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –ø–∏—â–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º YOLO –º–æ–¥–µ–ª–µ–π –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ FatSecret API.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [API Endpoints](#api-endpoints)
- [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [Docker](#docker)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

## üéØ –û–±–∑–æ—Ä

CalSnap API - —ç—Ç–æ FastAPI —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π:
- **–†–∞—Å–ø–æ–∑–Ω–∞–µ—Ç –ø–∏—â—É** –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –æ–±—É—á–µ–Ω–Ω—ã—Ö YOLO –º–æ–¥–µ–ª–µ–π (v8)
- **–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–ª–∞—Å—Å –ø—Ä–æ–¥—É–∫—Ç–∞** (pizza, apple, salad –∏ —Ç.–¥.)
- **–í—ã—á–∏—Å–ª—è–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å** –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (0-100%)
- **–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–ª–æ—Ä–∏—è—Ö** —á–µ—Ä–µ–∑ FatSecret API
- **–ü–µ—Ä–µ–≤–æ–¥–∏—Ç –Ω–∞–∑–≤–∞–Ω–∏—è** –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è –ª—É—á—à–µ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **FastAPI** - –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è API
- **YOLOv8** - –º–æ–¥–µ–ª—å –≥–ª—É–±–æ–∫–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
- **PyTorch** - —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è ML –º–æ–¥–µ–ª–µ–π
- **OpenCV** - –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–µ –∑—Ä–µ–Ω–∏–µ
- **Pillow** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **FatSecret API** - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–ª–æ—Ä–∏—è—Ö –∏ –ø–∏—Ç–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤–∞—Ö
- **Uvicorn** - ASGI —Å–µ—Ä–≤–µ—Ä
- **Docker** - –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

## üì¶ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Docker –∏ Docker Compose
- FatSecret API –∫–ª—é—á–∏ (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–ª–æ—Ä–∏—è—Ö)

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞

```bash
cd predicts
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ API –∫–ª—é—á–∏:

```env
FATSECRET_CONSUMER_KEY=your_consumer_key_here
FATSECRET_CONSUMER_SECRET=your_consumer_secret_here
```

### 3. –ó–∞–ø—É—Å–∫ —Å Docker

**Production —Ä–µ–∂–∏–º:**
```bash
docker-compose up -d
```

**Development —Ä–µ–∂–∏–º (—Å –ª–æ–≥–∞–º–∏):**
```bash
docker-compose -f docker-compose.dev.yml up
```

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
docker-compose down
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞
curl http://localhost:8000/health

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
# Swagger UI: http://localhost:8000/docs
# ReDoc: http://localhost:8000/redoc
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
predicts/
‚îú‚îÄ‚îÄ app.py                  # –ì–ª–∞–≤–Ω–æ–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ use_model.py           # –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å YOLOv8 –º–æ–¥–µ–ª—è–º–∏
‚îú‚îÄ‚îÄ nutrition.py           # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å FatSecret API
‚îú‚îÄ‚îÄ food_name_mapper.py    # –ú–∞–ø–ø–∏–Ω–≥ –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ food_name_ru.py        # –ü–µ—Ä–µ–≤–æ–¥ –Ω–∞–∑–≤–∞–Ω–∏–π –Ω–∞ —Ä—É—Å—Å–∫–∏–π
‚îú‚îÄ‚îÄ gui.py                 # GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
‚îú‚îÄ‚îÄ analyze_model.py       # –ê–Ω–∞–ª–∏–∑ –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ test_model2.py         # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
‚îú‚îÄ‚îÄ requirements.txt       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)
‚îú‚îÄ‚îÄ requirements.docker.txt # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (Docker)
‚îú‚îÄ‚îÄ Dockerfile             # Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml     # Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.dev.yml # Development –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env.example          # –ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ model/                # –û–±—É—á–µ–Ω–Ω—ã–µ YOLOv8 –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ model.pt          # –ú–æ–¥–µ–ª—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–æ—Å–Ω–æ–≤–Ω–∞—è)
‚îÇ   ‚îî‚îÄ‚îÄ model2.pt         # –ú–æ–¥–µ–ª—å –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤
‚îú‚îÄ‚îÄ temp_uploads/         # –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
‚îî‚îÄ‚îÄ runs/                 # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π
    ‚îú‚îÄ‚îÄ classify/         # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
    ‚îî‚îÄ‚îÄ segment/          # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏
```

## üîå API Endpoints

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –∑–¥–æ—Ä–æ–≤—å–µ

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|---------|
| GET | `/` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± API –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ endpoints |
| GET | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞ |

### –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø–∏—â–∏)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ |
|-------|----------|---------|-------------|
| POST | `/predict` | –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ (–∫–ª–∞—Å—Å, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Ç–æ–ø –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è) | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (multipart/form-data) |
| POST | `/predict/simple` | –ü—Ä–æ—Å—Ç–æ–π –∞–Ω–∞–ª–∏–∑ (–±—ã—Å—Ç—Ä–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ) | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (multipart/form-data) |
| POST | `/predict/with-nutrition` | –ê–Ω–∞–ª–∏–∑ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–∞–ª–æ—Ä–∏—è—Ö | –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (multipart/form-data) |

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–∞–ª–æ—Ä–∏—è—Ö

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|-------|----------|---------|-----------|
| GET | `/nutrition/{food_name}` | –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–ª–æ—Ä–∏—è—Ö –ø—Ä–æ–¥—É–∫—Ç–∞ | food_name - –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞ |

### –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **Swagger UI**: http://localhost:8000/docs
- **ReDoc**: http://localhost:8000/redoc

## üìã –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ—Å—Ç–æ–π –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (curl)

```bash
curl -X POST "http://localhost:8000/predict/simple" \
  -H "accept: application/json" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@pizza.jpg"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "product": "Margherita Pizza",
  "confidence": 95.5
}
```

### –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–∞–ª–æ—Ä–∏—è—Ö (curl)

```bash
curl -X POST "http://localhost:8000/predict/with-nutrition" \
  -H "accept: application/json" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@pizza.jpg"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "top_prediction": "Pizza",
  "top_prediction_ru": "–ü–∏—Ü—Ü–∞",
  "confidence": 95.5,
  "top_predictions": [
    ["Pizza", 95.5],
    ["Flatbread", 3.2],
    ["Bread", 1.3]
  ],
  "top_predictions_ru": [
    ["–ü–∏—Ü—Ü–∞", 95.5],
    ["–õ–µ–ø—ë—à–∫–∞", 3.2],
    ["–•–ª–µ–±", 1.3]
  ],
  "nutrition": {
    "title": "Pizza",
    "calories": 285.0,
    "protein": 12.5,
    "fat": 10.8,
    "carbs": 36.5,
    "calories_unit": "kcal",
    "protein_unit": "g",
    "fat_unit": "g",
    "carbs_unit": "g"
  }
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–ª–æ—Ä–∏—è—Ö (curl)

```bash
curl -X GET "http://localhost:8000/nutrition/apple" \
  -H "accept: application/json"
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "title": "Apple",
  "calories": 52.0,
  "protein": 0.26,
  "fat": 0.17,
  "carbs": 13.81,
  "calories_unit": "kcal",
  "protein_unit": "g",
  "fat_unit": "g",
  "carbs_unit": "g"
}
```

### –° –ø–æ–º–æ—â—å—é Python

```python
import requests

# –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –∫–∞–ª–æ—Ä–∏—è–º–∏
url = "http://localhost:8000/predict/with-nutrition"
with open("pizza.jpg", "rb") as img:
    files = {"file": img}
    response = requests.post(url, files=files)
    result = response.json()
    
print(f"–†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: {result['top_prediction_ru']}")
print(f"–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {result['confidence']:.1f}%")
print(f"–ö–∞–ª–æ—Ä–∏–∏: {result['nutrition']['calories']:.0f} kcal")

# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–ª–æ—Ä–∏—è—Ö
url = "http://localhost:8000/nutrition/apple"
response = requests.get(url)
nutrition = response.json()

print(f"–ü—Ä–æ–¥—É–∫—Ç: {nutrition['title']}")
print(f"–ö–∞–ª–æ—Ä–∏–∏: {nutrition['calories']} kcal")
print(f"–ë–µ–ª–∫–∏: {nutrition['protein']}g")
print(f"–ñ–∏—Ä—ã: {nutrition['fat']}g")
print(f"–£–≥–ª–µ–≤–æ–¥—ã: {nutrition['carbs']}g")
```

### –° –ø–æ–º–æ—â—å—é JavaScript/TypeScript

```javascript
// –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
async function analyzeFood(imageFile) {
  const formData = new FormData();
  formData.append('file', imageFile);
  
  const response = await fetch('http://localhost:8000/predict/with-nutrition', {
    method: 'POST',
    body: formData
  });
  
  const result = await response.json();
  return result;
}

// –ü–æ–ª—É—á–∏—Ç—å –∫–∞–ª–æ—Ä–∏–∏
async function getNutrition(foodName) {
  const response = await fetch(`http://localhost:8000/nutrition/${foodName}`);
  return await response.json();
}
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (–Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`):

```env
# FatSecret API (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–ª–æ—Ä–∏—è—Ö)
FATSECRET_CONSUMER_KEY=your_consumer_key_here
FATSECRET_CONSUMER_SECRET=your_consumer_secret_here
```

–ü–æ–ª—É—á–µ–Ω–∏–µ FatSecret API –∫–ª—é—á–µ–π:
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://www.fatsecret.com/api/
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–æ–ª—É—á–∏—Ç–µ –∫–ª—é—á–∏ (Consumer Key –∏ Consumer Secret)
4. –î–æ–±–∞–≤—å—Ç–µ –∏—Ö –≤ `.env` —Ñ–∞–π–ª

### –ü–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

API –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É **8000** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—Ç–∞ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `docker-compose.yml`:

```yaml
services:
  calsnap-api:
    ports:
      - "8080:8000"  # –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç —Ö–æ—Å—Ç–∞ (–ª–µ–≤–∞—è —Ü–∏—Ñ—Ä–∞)
```

## üê≥ Docker

### Docker Compose

**–ó–∞–ø—É—Å–∫:**
```bash
docker-compose up -d
```

**–ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:**
```bash
docker-compose logs -f calsnap-api
```

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞:**
```bash
docker-compose down
```

**–ü–µ—Ä–µ—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–∑–∞:**
```bash
docker-compose build --no-cache
docker-compose up -d
```

### Volumes

- `/app/model` - –ü–∞–ø–∫–∞ —Å –º–æ–¥–µ–ª—è–º–∏ (–ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞)
- `/app/temp_uploads` - –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### Environment Variables

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

### Health Check

–°–µ—Ä–≤–∏—Å –≤–∫–ª—é—á–∞–µ—Ç health check, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å API –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥.

## üßë‚Äçüíª –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–±–µ–∑ Docker)

1. –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:
```bash
python -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ (Windows)
venv\Scripts\activate

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ (macOS/Linux)
source venv/bin/activate
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
uvicorn app:app --reload --port 8000
```

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `use_model.py`

```python
from use_model import detect_food, detect_food_simple

# –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑
result = detect_food("image.jpg")
print(result['top_prediction'])      # –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
print(result['confidence'])           # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å (0-100%)
print(result['top_predictions'])      # –¢–æ–ø 5 –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–π

# –ü—Ä–æ—Å—Ç–æ–π –∞–Ω–∞–ª–∏–∑
result = detect_food_simple("image.jpg")
print(result['product'])              # –ù–∞–∑–≤–∞–Ω–∏–µ
print(result['confidence'])           # –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å
```

#### `nutrition.py`

```python
from nutrition import get_nutrition_info

# –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞–ª–æ—Ä–∏—è—Ö
nutrition = get_nutrition_info("Pizza")
print(nutrition['calories'])          # –ö–∞–ª–æ—Ä–∏–∏
print(nutrition['protein'])           # –ë–µ–ª–∫–∏
print(nutrition['fat'])               # –ñ–∏—Ä—ã
print(nutrition['carbs'])             # –£–≥–ª–µ–≤–æ–¥—ã
```

#### `food_name_ru.py`

```python
from food_name_ru import get_russian_name

# –ü–µ—Ä–µ–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
ru_name = get_russian_name("Pizza")
print(ru_name)  # "–ü–∏—Ü—Ü–∞"
```

### –ú–æ–¥–µ–ª–∏

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤–µ YOLOv8 –º–æ–¥–µ–ª–∏:

- **model.pt** - –û—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **model2.pt** - –ú–æ–¥–µ–ª—å –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤

–ú–æ–¥–µ–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ `model/` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ API.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏
python test_model2.py

# –ê–Ω–∞–ª–∏–∑ –º–æ–¥–µ–ª–∏
python analyze_model.py

# GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
python gui.py
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏

1. –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª –º–æ–¥–µ–ª–∏ –≤ –ø–∞–ø–∫—É `model/` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `model3.pt`)
2. –û–±–Ω–æ–≤–∏—Ç–µ `use_model.py` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–π –º–æ–¥–µ–ª–∏
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è

### CORS

CORS —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:
- https://food-track-beta.vercel.app
- https://foodtrack.vercel.app
- http://localhost:3000
- http://localhost
- –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ (`*`)

–î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è, –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `app.py`:

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[...],  # –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
)
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏

```
RuntimeError: CUDA out of memory
```

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ GPU. –ï—Å–ª–∏ –ø–∞–º—è—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞, –º–æ–¥–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∞ CPU.

### FatSecret API –æ—à–∏–±–∫–∏

```
"FatSecret API –∫–ª—é—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
```

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –§–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏
2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `docker-compose.yml`)
3. API –∫–ª—é—á–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã –Ω–∞ https://www.fatsecret.com/api/

### Timeout –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –±–æ–ª—å—à–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 10 MB. –ë–æ–ª—å—à–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É—é—Ç—Å—è.

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT.

```yaml
ports:
  - "9000:8000"  # –¢–µ–ø–µ—Ä—å API –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 9000
```

## Troubleshooting

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –º–æ–¥–µ–ª—å—é

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –º–æ–¥–µ–ª–∏ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø–∞–ø–∫–µ `model/model.pt`

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é

–î–ª—è –±–æ–ª—å—à–∏—Ö –º–æ–¥–µ–ª–µ–π –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —É–≤–µ–ª–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å Docker:
- Docker Desktop: Settings ‚Üí Resources ‚Üí Memory

### –û—á–∏—Å—Ç–∫–∞

```bash
# –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏ –æ–±—Ä–∞–∑
docker-compose down --rmi all

# –£–¥–∞–ª–∏—Ç—å volumes
docker-compose down -v

# –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ Docker
docker system prune -a
```

## Production –¥–µ–ø–ª–æ–π

–î–ª—è production —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.env` —Ñ–∞–π–ª —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ API –∫–ª—é—á–∞–º–∏
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å reverse proxy (nginx)
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
5. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–ü—Ä–∏–º–µ—Ä —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —Ä–µ—Å—É—Ä—Å–æ–≤ –≤ `docker-compose.yml`:

```yaml
services:
  calsnap-api:
    # ... –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
CalSnap-AI/
‚îú‚îÄ‚îÄ app.py                 # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ use_model.py          # –ú–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–µ–ª—å—é
‚îú‚îÄ‚îÄ nutrition.py          # –ú–æ–¥—É–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–ª–æ—Ä–∏—è—Ö
‚îú‚îÄ‚îÄ model/
‚îÇ   ‚îî‚îÄ‚îÄ model.pt         # –û–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ Dockerfile           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker –æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ docker-compose.yml   # Production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.dev.yml # Development –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .dockerignore        # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ .env                 # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)
‚îî‚îÄ‚îÄ requirements.txt     # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```
